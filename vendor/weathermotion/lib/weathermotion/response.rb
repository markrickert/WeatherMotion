# Describes the weather conditions for a particular requested location.
class WeatherMotion::Response
  # a WeatherMotion::Astronomy object detailing the sunrise and sunset
  # information for the requested location.
  attr_reader :astronomy

  # a WeatherMotion::Location object detailing the precise geographical names
  # to which the requested location was mapped.
  attr_reader :location

  # a WeatherMotion::Units object detailing the units corresponding to the
  # information detailed in the response.
  attr_reader :units

  # a WeatherMotion::Wind object detailing the wind information at the
  # requested location.
  attr_reader :wind

  # a WeatherMotion::Atmosphere object detailing the atmosphere information
  # of the requested location.
  attr_reader :atmosphere

  # a WeatherMotion::Condition object detailing the current conditions of the
  # requested location.
  attr_reader :condition

  # a list of WeatherMotion::Forecast objects detailing the high-level
  # forecasted weather conditions for upcoming days.
  attr_reader :forecasts

  # the raw HTML generated by the Yahoo! Weather service summarizing current
  # weather conditions for the requested location.
  attr_reader :description

  # a WeatherMotion::Image record describing an image icon
  # representing the current weather.
  attr_reader :image

  # the latitude of the location for which weather is detailed.
  attr_reader :latitude

  # the longitude of the location for which weather is detailed.
  attr_reader :longitude

  # a link to the Yahoo! Weather page with full detailed information on the
  # requested location's current weather conditions.
  attr_reader :page_url

  # the location string initially requested of the service.
  attr_reader :request_location

  # the url with which the Yahoo! Weather service was accessed to build the response.
  attr_reader :request_url

  # the prose descriptive title of the weather information.
  attr_reader :title

  def initialize (request_location, request_url, doc)
    # save off the request params
    #@request_location = request_location
    #@request_url = request_url

    # parse the nokogiri xml document to gather response data
    puts "Got to the initialization function."
    root = doc[:channel]
    puts root
    @astronomy = WeatherMotion::Astronomy.new(root['yweather:astronomy'])
    @location = WeatherMotion::Location.new(root['yweather:location'])
    @units = WeatherMotion::Units.new(root['yweather:units'])
    @wind = WeatherMotion::Wind.new(root['yweather:wind'])
    @atmosphere = WeatherMotion::Atmosphere.new(root['yweather:atmosphere'])
    @image = WeatherMotion::Image.new(root[:image])

    item = root[:item]
    @condition = WeatherMotion::Condition.new(item['yweather:condition'])
    @forecasts = []
    item['yweather:forecast'].each { |forecast| 
      @forecasts << WeatherMotion::Forecast.new(forecast)
    }
    @latitude = item['geo:lat'].to_f
    @longitude = item['geo:long'].to_f
    @page_url = item[:link].to_s
    @title = item[:title].to_s
    @description = item[:description].to_s
  end
end